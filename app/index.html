<!--
  https://www.w3schools.com/js/js_conventions.asp
-->

<html>
  <head>
   <meta name='viewport' content='width = device-width, initial-scale = 1.0, user-scalable = no'/>
   <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
   <script type="text/javascript" src="jquery-2.1.3.min.js"></script>
   <script type="text/javascript" src="introtoapps.min.js"></script>

   <script type="text/javascript">
   /* Namespacing
      Global Game Settings
   */
      var windowWidth = $(window).width(),
          windowHeight = $(window).height(),
          paused = false,
          debug = true;
          Burnout = {};

      function log(log) {
        if (debug == true) {
          console.info(log);
        }
      }

      Burnout.level = (function(){
        var level = 1,
            levelDuration = 100;

        function getLevel(){
          return level;
        };

        function setLevel(level){
          this.level = level;
        };

        return {
          getLevel: getLevel,
          setLevel: setLevel
        }
      }());

      Burnout.road = (function() {
        /* road Object state
           1. ROAD_SPEED: at which the road is animated.
              (Larger values indicate lower speed.)
        */
        var lanes = 4,
            ROAD_IMAGE01 = '.road01',
            ROAD_IMAGE02 = '.road02',
            ROAD_SPEED = 100;

        function initializeRoad() {
          $(ROAD_IMAGE01).css("transform",
                              "scale("+scaleFactor($(ROAD_IMAGE01).width())+")");
          $(ROAD_IMAGE02).css("transform",
                              "scale("+scaleFactor($(ROAD_IMAGE01).width())+")");
          }

        function animateRoad(){
          $(ROAD_IMAGE02).hide(ROAD_SPEED)
                         .show(ROAD_SPEED);
        }

        function roadWidth() {
          return $(ROAD_IMAGE01).width()  * scaleFactor();
        }

        function laneWidth() {
          return (roadWidth() / lanes);
        }

        return {
          initializeRoad: initializeRoad,
          animateRoad: animateRoad,
          laneWidth: laneWidth
        }
      }());

      Burnout.player = (function() {

        var playerCar01 = '.player01',
            playerScale = 0.15,
            playerTopPosition = 375,
            playerLeftPosition = 0,
            playerLanePosition = 1;

        function getPlayerPosition() {
            return playerLeftPosition;
        }

        function setPlayerPosition(position) {
            $(playerCar01).css("left", position + "px");
            return playerLeftPosition = position;
        }

        function initializePlayer() {
            log("scale Factor : " + scaleFactor());
            log("road height :" + $('.road01').height());
            log(imageScaleFactor($(playerCar01).width()));
            $(playerCar01).css("transform",
                               "scale("+(imageScaleFactor($(playerCar01).width()) *
                                playerScale)+")");
            $(playerCar01).css("top",
                               playerTopPosition * scaleFactor() + "px");
            //$(playerCar01).css("left",
              //                  (Burnout.road.laneWidth() * 0.25) + "px");
            //setPlayerPosition($(playerCar01).css("left")
              //                .substring(0, $(playerCar01).css("left").length - 2));
            setPlayerPosition(Burnout.road.laneWidth() * 0.25);
        };

        function updatePlayer(event) {
          if (event.clientX > getPlayerPosition()) {
            setPlayerPosition(Burnout.road.laneWidth() +
                              playerLeftPosition);
          }
          else if (event.clientX < getPlayerPosition()) {
            setPlayerPosition(playerLeftPosition -
                              Burnout.road.laneWidth());
          }
        };

        return {
          initializePlayer: initializePlayer,
          updatePlayer: updatePlayer
        }
      }());

      /* initialize game
         1. initialize Players Car
      */
      function initialize() {
        var d = new Date();
        log(d.toLocaleTimeString());
        Burnout.road.initializeRoad();
        Burnout.player.initializePlayer();
      }

      function scaleFactor() {
        if (windowWidth > windowHeight) {
          // landscape calculation
          return windowHeight / 512;
          return
        } else {
          // portrait calculation
          return windowWidth / 512;
        }
      }

      function imageScaleFactor(width) {
        return (512 / width * scaleFactor());
      }

      /* How do i build a game loop?
         level duration
      */
      function startGameLoop() {
        Burnout.road.animateRoad();
        if (!paused) {
          setTimeout(startGameLoop, 200);
        }
      }

      /* Entry point of the Application
         It is used to:
         1. startGameLoop
         2. addEventHandlers
      */
      $(document).ready(function() {
        initialize();
        startGameLoop();
          //$(".player01").moveTo(50);

        $("body").onTap(function(event) {
          Burnout.player.updatePlayer(event);
         });

         $("#menu").onTap(function(e) {
            var modal = document.getElementById('myModal');
            modal.style.display = "block";
            paused = true;
            log("pause game :" + paused);
         });

         $(".close").onTap(function(){
           var span = document.getElementsByClassName("close")[0];
           var modal = document.getElementById('myModal');
           modal.style.display = "none";
           paused = false;
           startGameLoop();
         });

         $(window).resize(function(event) {
           windowWidth = $(window).width();
           windowHeight = $(window).height();
         });
      });

   </script>

   <style type="text/css">

    .player01 {
      background-image: url('./images/cars_mini.png');
      background-size: auto;
      transform-origin: 0px 0px;
      width: 203px;
      height: 338px;
      position: absolute;
      z-index: 5;
    }

    body {
      position: relative;
      background-color: black;
    }
/*
    #sid {
      font-family: 'Lobster', cursive;
      font-size: 30;
      color: white;
      top: 10px;
      left: 300px;
      position: fixed;
      z-index: 5;
    }
*/
    #menu {
      font-family: 'Lobster', cursive;
      font-size: 30;
      color: white;
      top: 10px;
      left: 50px;
      position: fixed;
      z-index: 5;
    }

    .road01 {
      background-image: url('./images/tunnel_road01.png');
      background-size: auto;
      width: 512px;
      height: 512px;
      position: absolute;
      transform-origin: 0px 0px;
      z-index: -10;
    }

    .road02 {
      background-image: url('./images/tunnel_road02.png');
      background-size: auto;
      width: 512px;
      height: 512px;
      position: absolute;
      transform-origin: 0px 0px;
      z-index: -10;
    }

      /* The Modal (background) */
    .modal {
        font-family: 'Lobster', cursive;
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        z-index: 10;
    }

    /* Modal Content/Box */
    .modal-content {
        font-family: 'Lobster', cursive;
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 80%; /* Could be more or less, depending on screen size */
        z-index: 10;
    }

    /* The Close Button */
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-header {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
    }

    /* Modal Body */
    .modal-body {padding: 2px 16px;}

    /* Modal Footer */
    .modal-footer {
      padding: 2px 16px;
      background-color: #5cb85c;
      color: white;
    }

    /* Modal Content */
    .modal-content {
      position: relative;
      background-color: #fefefe;
      margin: auto;
      padding: 0;
      border: 1px solid #888;
      width: 80%;
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
      -webkit-animation-name: animatetop;
      -webkit-animation-duration: 0.4s;
      animation-name: animatetop;
      animation-duration: 0.4s
    }

    #help {
      background-color: lightblue;
    }

    /* Add Animation */
    @-webkit-keyframes animatetop {
      from {top: -300px; opacity: 0}
      to {top: 0; opacity: 1}
    }

    @keyframes animatetop {
      from {top: -300px; opacity: 0}
      to {top: 0; opacity: 1}
    }

   </style>
 </head>
 <body>
  <div class="road01"></div>
  <div class="road02"></div>
  <div id="menu">menu</div>
  <div class="player01"></div>

  <div id="myModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="close">&times;</span>
        <h2>Game Menu - Paused</h2>
      </div>
      <div class="modal-body">
        <p>Arvind Cuthambakam SID: 1234</p>
        <p style="color:red;" onclick="location.reload()">Reset Game</p>
        <div style="background-color: lightblue;" id="credits">
          <p>Credits</p>
          game_music.wav
        </div>
        <div id="help">
          <p>Help</p>
          <p>You win! when you clear the track without crashing</p>
          <p>Tap to avoid colliding with other cars</p>
        </div>
      </div>
    </div>
  </body>
</html>
